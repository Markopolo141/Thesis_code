\chapter{Existing solutions}
\label{cha:solutions}

In the previous chapter we discussed some of the philosophy surrounding distributive justice, and in this chapter we discuss some of the various ways those ideas can be made quantitatively precise.

In this chapter we consider some of the relevant formulations of the way that moral ideas about distribution can be mathemetised, primarily because our later developments extends from them and also ultimately contrasts against them.

We consider the following formulations:
\begin{itemize}
\item in section \ref{sec:solutions_VCG} we consider the Vickrey-Clarke-Groves (VCG) mechanism,
\item in section \ref{sec:solutions_LMP} we consider Locational Marginal Pricing (LMP),
\item in section \ref{sec:cooperative_game_theory_part} we consider cooperative game theory solution concepts including the Core and Shapley Value,
\item and in section \ref{sec:solutions_bargaining} we consider Nash's bargaining solution concepts.
\end{itemize}

%These different approaches stem from different moral considerations, %and primarily reward participants with respect to different reference points that are briefly addressed in section \ref{sec:reference_points}.
%All of them tacitly respect formal equality (per section \ref{sec:formal_equality}), with bargaining and cooperative game theory concepts satisfying absolute efficiency requirements (per section \ref{sec:philosophy_efficiency}), and LMP often does so.

These different approaches stem from different moral considerations and has specific context and unique properties; we will introduce and discuss each of them in turn.
In the next chapter \ref{cha:new_solution} we attempt a new synthesis which brings many of these conceptual elements together.\\
Let us begin with the VCG mechanism.

\section{VCG}\label{sec:solutions_VCG}

In section \ref{sec:reference_points} we briefly presented the idea that people might be rewarded in proportion to their contribution to social welfare, above their absence, individually.
While this idea may be simple, its mathematisation has some surprising features.
The most direct mathemetisation of this idea is the Vickrey-Clarke-Groves (VCG) mechanism with Clark pivot.

The VCG mechanism (with Clark pivot) is an allocation process where each player is payed `transferable utility' (or money) equal to the impact that their presence has upon others (ie. their externality) in the decision process which selects an outcome that maximises the sum of utility.
Let us explain with some mathematics:

\subsection{The minimal VCG process - with Clark pivot}
If we frame the VCG process as a bidding process of $n$ agents over a possible set of outcomes $X$.
We assume that every agent $i$ has a valuation (or utility) $v_i$ for any outcome in $X$:
$$ v_i~:~X\rightarrow \mathbb{R}_{\ge 0} $$
The VCG bidding process asks every agent $i$ for their valuations and calculates the outcome that maximises the sum of the reported valuations:
$$ x^* = \argmax_{x\in X}\sum_{i=1}^{n}v_i(x) $$
This outcome is implemented and the bidding process pays each agent $i$ the utility value $d_i$ (which may be positive or negative):
\begin{equation}\label{eq:VCG_payment_rule} d_i(v)=\sum_{j\ne i}v_j(x^*) - \max_{x'\in X}\sum_{j\ne i}v_j(x') \end{equation}
And this value $d_i$ is the value that the player's presence adds to the utility of others minus the sum of their utility which would have been obtained in the player's absence - ie. the player's externality.

\begin{example}
Consider a set of outcomes $X = \{A,B,C\}$ and three agents with valuations 
$$\begin{matrix}v_1(A) = 2\\v_1(B) = 4\\v_1(C) = 3\end{matrix}\quad\quad
\begin{matrix}v_2(A) = 4.5\\v_2(B) = 2\\v_2(C) = 1\end{matrix}\quad\quad
\begin{matrix}v_3(A) = 2\\v_3(B) = 1\\v_3(C) = 5\end{matrix}$$
In this context $x^* = C$ is implemented (as $\sum_{i=1}^nv_i(C)=9$ is the biggest)\\And:
$\quad d_1 = 6-6.5 = -0.5 \quad\quad d_2 = 8-8 = 0\quad\quad d_3 = 4-6.5 = -2.5 $
\end{example}

\subsection{Discussion about VCG}
The VCG mechanism with Clark pivot might be seen as an straightforward way of assigning an outcome and allocating ethical payments; if a player's presence adds to the utility of others then they are positively compensated, and if a player's influence detracts from the utility of others then they are negatively compensated.

Since the set of possible outcomes $X$ are undefined it is possible to consider the application of the VCG mechanism in a variety of contexts.	
For instance, VCG has been considered as a mechanism for allocating physical and monetary outcomes in various contexts within electricity networks, such as in auctions for bulk electricity generation, buying and selling energy storage products, and in procuring ancillary services \cite{FABRA200272, SESSA2017189, 8264596, 7512339}.

However VCG has some particular advantages and disadvantages.
The first and most notable property is that VCG mechanisms are \textit{truthfull} or \textit{incentive compatible}, in that no single player can possibly gain by misreporting their valuations in the event that the utility of the agents is \textit{quasilinear} \cite{roberts1979characterization, Lavi2008}.
An agent's utility is quasilinear if their utility is equal to their valuation of the outcome plus any transfers they receive, and hence their utility $u_i$ has form:
$$ u_i = d_i(v)+v_i $$
And thus if incentive compatibility induces the players not to bid strategically, then it reduces a potential overhead of their participation in the system, and also potentially eliminates a source of instability in the resulting system.

Another interesting property is called \textit{individual rationality}, in that no agent (assuming quasilinear utility) will ever be left with a net negative utility. Particularly if the utility of zero is regarded as the utility of non-participation, then individually rational means that everybody is left being better-off by participating than they would be otherwise. Hence individual rationality is a possible of ethical euvolentary negotiation (see chapter \ref{sec:reference_points}).

It is also worth noting that VCG mechanisms are also \textit{efficient} in the sense that the process actualises the utilitarian socially optimal solution $x^*(v) \in X$.

However, more negative features of VCG exist, one primary drawback of this mechanism is that it is not \textit{budget balanced}, in that it is possible for the amount of utility that is transferred between the players might not sum to zero.
Because of this an implementation of VCG might require regular budget injection to maintain and/or produce a budget surplus, hence sapping money from between the participants (see example).
Because VCG may produce a budget surplus from between the participants it is hence easy to note that the maximum amount of utility is not being given to the participants, and hence VCG is not efficient in the sense of maximising utility for the participants (see section \ref{sec:philosophy_efficiency}).

Although VCG is incentive compatible for individual strategisers it is potentially vulnerable to strategising coalitions, additionally its implementation may involve imposing a lack of privacy for participants, and also (depending on context) may also have higher computational complexity than other mechanisms.\cite{ShohamLeytonBrown09}

The disadvantages of VCG have made it seldom implemented in practice, also in electricity networks.\cite{Rothkopf07, Ausubel2006}

As VCG has positive and negative features, it is possible to ask if there are similar mechanisms which avoid some of the negative features.
But it is unfortunate, that some of these properties (incentive compatible, individually rational, budget balanced, and efficiency) are known to be impossible to combine in the general case (where there are a plurality of outcomes and the valuations are unrestricted), and these impossibility theorems are a feature in the study of \textit{Mechanism Design}.%(find a good source, of, myerson satterthwaite theorem)

\subsection{Mechanism Design, is there a better VCG?}

The VCG mechanism is a cornerstone component in the field of Mechanism Design, and there exist many good sources giving extended discussions on the field.\cite{37377}
But generally, Mechanism Design conducts the analysis of systems which select social outcomes based upon the result of strategic interactions of multiple parties with divergent interests.% and where each party has actual preferences over the possible outcomes, and also reported preferences over the outcomes.

One of the features of Mechanism Design that the VCG mechanism illustrates, is the potential for considering and apprehending the way in which a system is likely to behave between rational individually strategising agents.
This possibility extends beyond VCG, as it has been discovered that any system which is implemented between strategising agents can be altered such as to make it incentive compatible for them; this is called the revelation principle.\cite{RePEc:ecm:emetrp:v:41:y:1973:i:4:p:587-601} \cite[Chapter~2.3]{37377}
The revelation principle has various formulations, but generally, for any system there will some Nash-equilibria in the interaction between the agents, and consequently an incentive compatible mechanism can be constructed by asking the agents for their true valuations and then implementing the corresponding Nash-equilibria directly.
Unfortunately, it is sometimes the case that the Nash-equilibria between strategising agents may not coincide with what is socially optimal for them; and the general difficulty of designing systems where the socially optimal outcome is always a Nash-equilibrium is rendered in some of the famous impossibility theorems in Mechanism Design. %And so, there are a series of strong impossibility proofs in mechanism design.

Some of the primary historic impossibility proofs in Mechanism Design concern voting and social choice systems, and notably include Arrow's impossibility theorem, and the Gibbard-Satterthwaite theorem.
But the difficulty does not necessarily recede even if monetary compensations between parties are included into consideration, such as per the Myerson-Satterthwaite theorem.
Another impossibility theorem was also proven by Green and Laffont \cite{29088} to the effect of proving that there is no easy alternative to VCG - a mechanism which is incentive compatible, has unrestricted player preferences, has individual rationality, and implements a socially optimal outcome, in the case of quasilinear utilities.

In the evolving field of Mechanism Design there are several avenues of mitigating some of the impossibilities.

%\subsection{Navigating around impossibilities of Mechanism Design to a better VCG}

One of the main problems in applying VCG to electricity networks is the fact that it is not budget-balanced, and this raises a question of where the budget surplus/deficit should be channelled to/from.
Particularly if the money should be directed back to the participants in the electricity network, then it would destroy the incentive compatibility that was part of the scheme in the first place.
This is a direct consequence of the impossibility result of Green and Laffont \cite{29088} and hence we are constrained to consider mechanisms which are suboptimal in relation to these qualities (budget balance, incentive compatibility, individually rational, and efficiency).
However it is also known that there are no mechanisms which allow bounded deviations from the efficiency, incentive compatibility and budget-balance \cite{YI201679}.

Thus a search for a better alternative than VCG needs to outright sacrifice or substitute some of these desirable properties.

Although we cannot go into too much detail about the field of Mechanism Design in this chapter (and the different kinds of impossibility theorems and kinds of incentive compatibility), we can highlight some interesting options.

\subsubsection*{Redistribution in Groves mechanisms}

One potential avenue of averting the impossibility result is to discard the assumption that the player's valuation over outcomes are unrestricted, and recognise that some of the budget surplus/deficit can be redistributed without destroying the incentive compatibility property.

To frame this approach, we must make a technical distinction between a Groves mechanism and its particular instance - in the VCG mechanism.
A Groves mechanism is exactly the same as the VCG mechanism except instead of paying players per equation \ref{eq:VCG_payment_rule}, instead it pays them per:
\begin{equation}\label{eq:Groves_payment_equation} d_i(v)=\sum_{j\ne i}v_j(x^*(v)) - C_{-i} \end{equation}
where $C_{-i}$ is some function that is independent of $i$'s reported preferences.
In this context it is notable that the VCG mechanism is a special case of a Groves mechanism where $C_{-i}= \max_{x'\in X}\sum_{j\ne i}v_j(x')$. \cite{10.2307/1914085}
Groves mechanisms are a class of mechanisms which include VCG, and are categorically incentive compatible. 

The challenge therefore is to derive optimal functions $C_{-i}$ which minimise the budget surplus/defecit while maintaining individual rationality in the context of restricted player valuations.
For this purpose there has been significant discussion about deriving these $C_{-i}$ functions, also known as `VCG redistribution' rules.

One of the first people to propose such a rule was Ruggiero Cavallo \cite{Cavallo:2006:ODM:1160633.1160790}.% who showed that such a redistribution rule exists with with a performance exceeding VCG.
Who showed that much of the VCG surplus can be redistributed in a process of allocating a single physical object exclusively to one party (called `All-Or-Nothing' games), where it can be naturally assumed that any party has a utility of zero if they do not recieve the physical object.
This redistribution was possible primarily because there exists a simple constraint on player valuations - ie. not receiving the object has utility of zero.

Similarly in other situations where there are restrictions on the players valuation over the outcomes, there is the potential for deriving VCG redistribution rules.

However there are some difficulties with this approach, particularly it is known that even with VCG redistribution rules there will almost always be some remaining budget surplus, and even then the process of deriving optimal redistribution rules can be a difficult and complex task --- even to the point where neural networks have been employed to construct such functions \cite{DBLP:conf/atal/ManishaJG18}.

\subsubsection*{Sacrificing efficiency with budget sinks}

Another avenue is to sacrifice efficiency of outcome selection.
One of the simplest such schemes is given by Boi Faltings \cite{10.1007/978-3-642-25510-6_14, 10.1007/978-3-642-25510-6_14}
Who proceeds about the process of designing a non-pareto optimal VCG mechanism by splitting the population into two groups, where the VCG outcome from the first group is selected irrespective of the preferences in the second group.
and where the second group (the `sink') receives the budget surplus from the VCG mechanism applied to the first group.
This mechanism constitutes a budget balanced VCG-type mechanism which can be made a little bit more regular by randomly selecting the `sink', and splitting the budget surplus between the parties evenly without knowledge of who will be selected.\cite{10.1007/978-3-642-25510-6_14}

Particularly this method selecting a non-pareto optimal outcome has been the subject of investigation, and the process is proven to necessarily need a sink and that there are different ways to select an appropriate sink randomly \cite{NATH2019673}.

However it is expected that such a mechanism of randomly assigning a sacrificial `sink' could potentially be ethically dangerous; potentially falling afoul of Formal Equality ideas (see section \ref{sec:formal_equality})


%\subsubsection{switching to Baysean incentive compatability}

%is the source of the d'AVGA mechanism which allocates redistribution of the surplus bassed on baysean priors on player preferences.
%The addition of baysean priors also has links to bargaining, particularly with the work of Meyerson, and his bargaining games.
%Which in turn have been extened (by himself) to coalitional games, and also through some of his work to Harsanyi games. (CITE)
%Particularly through the introduction of baysean considerations other schemes can redily be made to be incentive compatable.
%However there are certain issues with supposing accurately known baysean priors (particularly if they are learnt from past behavior).

%And although incentive compatability is a noble objective in mechanism design, it is still subject to strategic manipulation, particularly in the context of the forming of coalitions.

%Coalition strategy proofness, has been proven to be quite generally a difficult concept to design, and in some cases has categorically proven to be impossible \cite{10.2307/2297048} without further elements, such as private information transfer and uncertainty.
%Although there has been some effort in designing and analysing the occurance of coalition proof mechanisms, these remain difficult.


\subsection{Summary and discussion of VCG}\label{subsec:summary_discussion_VCG}

The VCG mechanism frames a elegant ethical schema for distributive payments and is directly applicable to electricity systems.
Although it is incentive compatible, the primary practical draw-back to such a system is that it is not budget-balanced.
Unfortunately there is no easily implementable system that is like VCG that is incentive compatible and is budget-balanced without forcing participants to potentially trade at a loss.

Notwithstanding it is a possible scheme for the trading of electricity and electric resources, and in the following chapter we will compare the allocations of power/money in randomly generated networks under VCG against other schemes.

One of the most features about VCG, is that it is one of the most direct expressions of marginal payments - in that each participant is payed the marginal difference their presence causes to the well-being of the other participants.
This marginal quality is shared by two other solutions of this chapter, particularly Locational Marginal Pricing (section \ref{sec:solutions_LMP}) and Shapley Value (section \ref{subsec:the_shapley_value}).

One of the most notable qualities of VCG is that when it is scaled up to large numbers of participants (and no specific participants are particularly influential) then VCG often limits to another solution concept called Locatinal Marginal Pricing, which often is budget balanced.\cite{NATH2019673, 8430852}.


\section{Locational Marginal Pricing}\label{sec:solutions_LMP}

In Section \ref{sec:reference_points} we briefly considered the notion that %moral and euvoluntary trading would result in normative market pricing; and potentially that 
the morality of a transaction could be framed with respect to the normal market prices.
There is potentially no greater framework for describing nominal market pricing in economic thought more influential than the concept of the \textit{margin} or more specifically \textit{marginal pricing}.

The idea that normal market trading should have any relation to moral trading was seen in John Locke's short essay Venditio \cite{locke2003locke} where it is argued that a fair price for something is simply its normal market price at its location.\footnote{``... the market price at the place where he sells. Whosoever keeps to that in whatever he sells I think is free from cheat, extortion and oppression, ...''}
John Locke argues for this thesis, by considering that negotiating above market price for a good would be unethical as it would taking advantage of ignorance or special circumstance of the buyer, but that negotiating below market price would only incentivise reselling and allow others to profit at the original seller's loss.
Additionally that selling below market price only to those who are needy is certainly a charity and hence cannot be required by justice, but that justice only requires offering no more than the same nominal market price for everybody.

While John Locke's arguments may or may not be convincing, it is useful to consider the transactions and pricing that would occur under idealised or normative euvoluntary trading.
As these prices may be a moral in-themself, or provide a back-drop for the framing of more moral trading.
In section \ref{sec:solutions_bargaining} we consider mathematical schemas used to describe idealised normative bargaining between small numbers of participants, but in this section we describe some economic theory that has been used to describing normalised trading between large numbers of market participants.

%Unfortunately the determination of normalised trading, and normal market price is not nessisarily so easy to distill in practice.
Historic economic thought lends consideration to the idea that market prices can be described by combinations of factors, not limited to, supply and demand functions, market uncertainty, production costings and transport tariffs etc. and the combination of these may be related to the pricing and subsequent trading of the goods.
However, the way in which these factors have been seen to influence (or define) economic value has changed over time.

\subsection{A brief summary on the history of value}

In the history of economic thought, there was some general idea that the economic value of something (and hence its normal market price) should, in some way, be related to its usefulness in fulfilling human needs (however fickle or not) as things which are utterly useless seldom fetch any price.
%Even so far as to categorising into numbered classes different goods depending on their relation to satisficing needs (eg. \cite[Chapter 1]{mengerprinciples}).
%Such as where different needs (eg. hunger) require first-order goods (eg. bread) to satisfy them, and thoes require second-order goods to provide (eg. flour to make bread), and so on. 
But, above this, there was a difficulty explaining how it was that things which were most useful to satisfying needs often had little economic value, and things which were more useless were sometimes most economically valuable. This apparent contradiction is known as the water-diamond paradox, best put by Adam Smith:

%\begin{displayquote}
%The word VALUE, it is to be observed, has two different meanings, and sometimes expresses the utility of some particular object, and sometimes the power of purchasing other goods which the possession of that object conveys. The one may be called `value in use;' the other, `value in exchange.' The things which have the greatest value in use have frequently little or no value in exchange; and, on the contrary, those which have the greatest value in exchange have frequently little or no value in use. Nothing is more useful than water; but it will purchase scarce any thing; scarce any thing can be had in exchange for it. A diamond, on the contrary, has scarce any value in use; but a very great quantity of other goods may frequently be had in exchange for it.\cite{Smith1Gutenberg}
%\end{displayquote}

\begin{displayquote}
The word VALUE, it is to be observed, has two different meanings, ... The things which have the greatest value in use have frequently little or no value in exchange; ... Nothing is more useful than water; but it will purchase scarce any thing; ... A diamond, on the contrary, has scarce any value in use; but a very great quantity of other goods may frequently be had in exchange for it.\cite{Smith1Gutenberg}
\end{displayquote}

In answer to this, there was promoted the idea that economic value reflects labor, as water is easy to procure but diamond is not so.
This `labor theory of value' was held by many authors (including Adam Smith\footnote{``The real price of every thing, what every thing really costs to the man who wants to acquire it, is the toil and trouble of acquiring it.''\cite{Smith1Gutenberg}}, David Riccardo\footnote{``The value of a commodity, or the quantity of any other commodity for which it will exchange, depends on the relative quantity of labour which is necessary for its production...''\cite[Section 1, Chapter 1]{Riccardo1Gutenberg}}, and many others) but most notably by Karl Marx:

\begin{displayquote}
It suffices to say that if supply and demand equilibrate each other, the market prices of commodities will correspond with their natural prices, that is to say with their values, as determined by the respective quantities of labour required for their production \cite[Chapter 2]{marx1910value}
\end{displayquote}

And this idea, that the quantity of labour should (in some way) define market prices at market equilibrium, was subject to analysis and verification.
But ultimately the question of how to transform volumes of labour into competitive market prices became a difficult problem known as the `Transformation Problem'.

However, the various utilitarians of the 19th century viewed utility no only as a direction of moral efforts, but as a fundamental drive of human behaviour\footnote{for instance see Bentham: ``Nature has placed mankind under the governance of two sovereign masters, pain and pleasure.
It is for them alone to point out what we ought to do, as well as to determine what we shall do.''\cite{bentham1823introduction}}, including market behaviours such as price setting; and ultimately, this perspective yielded a new explanation for economic value.

The utilitarian perspective sought to explain market dynamics in terms of people's efforts to maximise their own utility (or more practically, profit), and in this context stable (and hence normal) market prices were associated with the equilibrium of those efforts.
This perspective yielded a link between market dynamics with the concept of the margin - or `marginalism'.

Although the concept of the margin was evidenced in some writings in the earlier half of the 19th century (such as in the works of Jules Dupuit and Hermann Heinrich Gossen), it took to the end of the century for the idea to become more thoroughly developed \cite{RePEc:ucp:jpolec:v:58:y:1950:p:307}.
Although there was much discussion about the relationship between the labour theory of value and marginalism at the end of the 19th century \cite{steedman2003socialism} ultimately marginalism was adopted mainstream in the so-called 'marginal revolution', defining the beginning of neoclassical economics.\cite{marginalism1}

The marginalist revolution saw that economic prices were not just equal to the summation of normal production costs\footnote{Such as promoted by Riccardo, ``The real and ultimate regulator of the relative value of any two commodities, is the cost of their production, and neither the respective quantities which may be produced, nor the competition amongst the purchasers.''\cite{Riccardo1Gutenberg}} (ultimately depending on the value of labor), but instead depended on the cost of production of the most marginal unit produced to meet demand.

\subsection{A sketch of Marginalism}\label{subsec:marginal_price_sketch}

The idea of marginalism is best illustrated with a graph, in Figure \ref{fig_demand_supply} is reflected a hypothetical market for a particular economic good, with many suppliers and many buyers.
In the figure we have the plotted the `Supply curve', identifying how many units of the good could be sustainably supplied to the market if the units sold for a particular price.
And we also have the `Demand curve', identifying how many units of the good would be sold depending on the price which the goods sold at.
If the goods have a set price and the market is functioning ideally, then there is only one sensible outcome: that the goods should be sold in the number (and therefore at the price), that is at the intersection of the supply and demand curves - ie. the marginal price point.
For if there were more goods produced, then those excess units would be unsold hence their production would be unprofitable, and if there were less goods produced, then there would be unmet demand which would spur more production.

Different sellers may choose different prices in a market, however if any small individual seller tried to deviate from this marginal price in the context of such an ideal market, then it would be a disadvantageous for them.
If a seller tried to set a higher price than the marginal rate then it would result in a failure to sell, or if a seller set a lower price then it would only result in less profit.
In this way, the marginal price point identifies an equilibrium of peoples utility (or profit) maximising efforts.

This kind of marginal analysis is a short sketch of the analysis and treatment in modern microeconomic texts (such as \cite{vohra_2020}).
This marginalist analysis is also widely regarded to resolve the water-diamond paradox, in that water is cheap because its marginal unit is cheap to produce.

Over time the marginalist synthesis was developed more comprehensively in the presence of many discussions and criticisms.
Particular criticisms attack the academic assertion that market participants are psychologically driven by rational utility maximisation \cite{RePEc:ucp:jpolec:v:58:y:1950:p:307}\footnote{individual traders in any market are atleast partially driven by irrationality such as fear, ignorance and gambling}, and the more pragmatic assertion that markets are approximately ideal and tend towards the stability of equilibrium \cite{nla.cat-vn5739105}\footnote{as might be witnessed in markets where is inherent uncertainty, notably in speculative markets such as stocks, housing and crypto-currency}.

\input{figs/demand_supply.tex}

Notwithstanding, one of the most notable features of this neoclassical analysis is that the equilibrium marginal price point also maximises the sum of utility of those that participate in the market.
This can be seen from Figure \ref{fig_demand_supply} where all the buyers who value the goods the most are provided the goods they require from all the sellers who can supply those goods at lowest cost up until the marginal point where no further trade is viable.

This point of utility maximisation is seen in Neoclassical analysis more generally, where market equilibrium prices (at and/or between markets) occur at the point of the maximisation of the sum of utility.
Indeed, process of mathematically deriving these marginal prices developed is associated with a kind of calculus, where the marginal prices fall out as Lagrange multipliers in the process of maximising the sum of utility.

To see this, consider the curves in figure \ref{fig_demand_supply} where the Demand function is\\ $D(x) = 20(x/40)^2$ and the Supply function is $S(x) = \frac{40}{1+(x/40)^2}$.

From these functions\footnote{We could, more directly, observe that by solving $S(x)=D(x)$ we get $x=40$.} we construct the utility of the buyers and sellers as:
$$U_s(x) = \int_0^x\frac{-40}{1+(z/40)^2}dz \quad\quad\text{and}\quad\quad U_d(x) = \int_0^x20\left(\frac{z}{40}\right)^2dz$$
If the amount of the goods bought is $a$ and the amount supplied is $b$ then we can construct the utility function as $U(a,b) = U_d(a) + U_s(b)$
and to maximise this subject to constraint $a=b$, we use lagrange's method of multipliers, and form lagrangian:
$L(a,b,\lambda) = U_d(a) + U_s(b) + \lambda(b-a)$
$$\frac{\partial L}{\partial a} = 20\left(\frac{a}{40}\right)^2 - \lambda = 0 \quad\quad\text{thus:}\quad\quad a = 40\sqrt{\lambda/20}$$
$$\frac{\partial L}{\partial b} = \frac{-40}{1+(b/40)^2} + \lambda = 0 \quad\quad\text{thus:}\quad\quad b = 40\sqrt{40/\lambda - 1}$$
substituting into the constraint $a=b$ gives $\lambda=20$ and thus $a=b=40$\\
In this way the Lagrange multiplier on the conservation constraint gives the marginal price of the good - which is also called the `shadow price'.

The general development of the mathematics is slightly beyond our scope here, but the general process is:
\begin{enumerate}
\item formulate the utility function from all the market participants, including all variables
\item form an optimisation problem for utility maximisation, with appropriate conservation constraints
\item solve the optimisation problem, and record the Lagrange multipliers of the conservation constraints as shadow prices.
\end{enumerate}
This process, of using calculus to determine nominal prices has been proposed in the electricity space in recent years \cite{lmp1, lmp2, lmp4, game3}.
Particularly as the process of maximising utility on an electricity grid is a well known problem called the `Optimal Power Flow' problem (OPF), where the power conservation constraint at each bus of the network, identifies the marginal price of electrical power on that bus.
This particular scheme is called `Locational Marginal Pricing' (LMP); and we will investigate and compare against it in section \ref{sec:features}.

Particularly, we note that LMP has been implemented for real-time-pricing of transmission power in some existing electricity systems \cite{WANG2015695,zonal}.
And that although LMP is like VCG in that it is ultimately not budget balanced, unlike VCG there are specifically identifiable cases which often occur where it is.\cite{lmp2}


\subsection{Summary and discussion of Locational Marginal Pricing}

Locational Marginal Pricing is a historic example of an economic framework of integrating market conditions (supply and demand information) to give equilibrium price points.
It can be seen to provide a sensible description of normal trading value, and thence (perhaps) moral trading value.

Locational Marginal Pricing and VCG provide some of the most direct expressions of Marginalism as a concept, and (as considered in section \ref{subsec:summary_discussion_VCG}) one can limit to the other for large markets.
Particularly VCG rewards participants with economic incentives equal to their direct impact on group wellbeing above their absence whereas Locational Marginal Pricing can be seen as providing participants with economic incentives in proportion to their presence's incremental impact on group wellbeing.

With VCG it is directly considered what the notion of absence means, particularly the difference the presence of a participant makes is in relation to the affect the participant's utility brings upon the social utility maximum.
However the notion of absence under LMP may be less clear; the marginal prices are the rate of incremental utility value of additional goods at the respective location, which in turn is the incremental rate that each participant's presence brings at that location.

In the following chapter LMP and VCG are implemented and the differences between the two can be witnessed.
%Both are expressions of marginalism, in that both revolve around the socially optimal utility point, and reward participants with respect to their contribution to it.

Both LMP and VCG root their concept of value in the idea of marginal contribution implicitly with respect to some notion of absence. However, in other contexts it may not be clear what this means, in section \ref{sec:solutions_bargaining} we outlay some solutions concepts which which embrace this ambiguity.

However before we move to section \ref{sec:solutions_bargaining}, we notice that both LMP and VCG only treatment of every player individually, but neglect any consideration of potential groups of players and their influence.
And so, in the next section \ref{sec:cooperative_game_theory_part} we consider solution concepts which explicitly consider group influence and marginal contributions therein.



\section{Cooperative Game Theory}\label{sec:cooperative_game_theory_part}

In section \ref{sec:reference_points} we considered the idea that groups of people could be afforded what they could achieve `by themself'.
And this idea is most directly articulated by the \textit{Core} of cooperative game theory.
In that same section we also mentioned the idea that people could be rewarded for their contribution under uncertainty about the presence of other group members, and that this idea was most directly articulated by the \textit{Shapley Value} of cooperative game theory.

Both of these ideas directly or implicitly consider possible groups and how much value each group has `by itself', and this is directly the ground of cooperative game theory.

The basic elements of a classic cooperative game are that there is a set of players or individuals $N=\{1,2,\dots n\}$ and a function $v: S\subseteq N \rightarrow \mathbb{R}$ with $v(\emptyset)=0$ called the \textit{characteristic function}.
The characteristic function identifies in some sense the `worth' or `value' of any group of players (a `coalition') which might be interpreted in terms of utility or monetary value.
In this context, one aim of cooperative game theory is to develop schemes (or `solution concepts') which split the wealth achieved if everybody cooperated (that is $v(N)$) between all the players.

Fundamentally, this kind of analysis hinges on there being a clearly defined concept and determination of the value of each possible group (ie. the characteristic function), however it is not always the case that there is such a clearly defined notion.
Consider the words of Lloyd Shapley about the characteristic function:

\begin{displayquote}
The idea is to capture in a single numerical index the potential \underline{worth} of each coalition of players.\\
...

With the characteristic function in hand, all questions of tactics, information, physical transactions, etc., are left behind. The characteristic function is primarily a device for dividing the difficulties -- for eliminating as many distractions as possible in preparation for the confrontation with the indeterminancy of what we have called the ``n-person problem''. Engrossed with this problem, many authors writing after von Neumann and Morgenstern have begun by basing their solution concepts on the characteristic function above, with no initial concern for the concrete rules of the game, in strategic or extensive form.

Unfortunately, not all games admit a clean separation between strategic and coalitional questions, and for those that do not the characteristic function approach must be modified or abandoned.\cite{ShapleySchubikCharacteristicFunction}
\end{displayquote}

In this light, there exist situations where the `worth' of a coalition may be ambiguous such as where there are strategic considerations between possible coalitions, and there is no uniquely defined value that members of a coalition could/would achieve.
However, some situations do cleanly admit a definable `worth' for groups of individuals, for instance, the Characteristic function may identify the amount of money that members of a coalition could, and unambiguously would, achieve by working for themself irrespective of the actions of those not belonging to the coalition.

In these cases, if everybody works together to achieve some maximal sum of money there are a set of possible ways the money can be divided between everybody.
One of the most natural divisions is that every subgroup should be given at least more than they could feasibly achieve by working for themself.
And this is an allocation most naturally described by the \textit{Core}.

\subsection{The Core}

The Core is an example solution concept for cooperative games, in that for any set of players $N=\{1,2,\dots n\}$ and any characteristic function $v: S\subseteq N \rightarrow \mathbb{R}$ with $v(\emptyset)=0$, the Core is a set of possible payoff allocations to each of the players $C(v)$ in which each subgroup is given atleast the value of the characteristic function for that subgroup:

$$ C(v) = \left\{x\in\mathbb{R}^n : \sum_{i\in N}x_i=v(N); \sum_{i\in S}x_i \ge v(S), \forall S\in N \right\}$$

The Core is the set of possible allocations such that the sum of them equals what can be achieved by everybody working together (the worth of the `grand coalition' - $v(N)$) and such that for any group of individuals, the sum allocated to those individuals is greater than what they could achieve by working by themself.

The allocations in the Core might be seen to have a kind of stability property - in that no coalition would have an incentive to leave the grand coalition. One major drawback about the Core is that it does not determine a unique outcome, but potentially a range of outcomes or potentially none at all, depending on the cooperative game.

Indeed the Core may be empty, and in this case no solution can posses the same kind of desirable stability, however there are alternative allocations that minimise this shortcoming.
Most notably, the \textit{least-Core} solution concept.

The least-Core solution concept is a particular instance of the \textit{strong $\epsilon$ Core} which is very similar to the Core, and is defined as follows:
$$ C_\epsilon(v) = \left\{x\in\mathbb{R}^n : \sum_{i\in N}x_i=v(N); \sum_{i\in S}x_i \ge v(S)-\epsilon, \forall S\in N \right\}$$
The strong $\epsilon$ core is the set of allocations in which each coalition is allocated atleast their value minus some constant $\epsilon$.
In this way some coalitions might be shortchanged, but only by atmost a constant factor $\epsilon$.
The strong $\epsilon$ Core can be defined for positive and negative $\epsilon$ values, it will certainly be non-empty for very large and positive $\epsilon$ values and certainly be empty for very large and negative $\epsilon$ values.
In this way we can consider the limiting case between these two, the smallest value of $\epsilon$ in which the strong $\epsilon$ Core is non-empty --- and this is the least-core.\cite{doi:10.1287/moor.4.4.303}
The least-core is therefore always non-empty and may even identify a singular solution point, which that can be said to identify the point of minimum `dissatisfaction' between the groups.

The Core is an intuitive solution concept in the context where the characteristic function identifies the `worth' of individuals and groups `by-themself' and the dynamics are driven by this isolation mechanic.
However in other cases the `worth' identified by the characteristic function may be in the context of cooperation with the others.
And in this context the Core is not the only solution concept worth considering.

\subsection{The Shapley Value}\label{subsec:the_shapley_value}

The \textit{Shapley value} is another specific and well known solution concept in cooperative game theory.
Particularly the Shapley value allocates to each individual the average contribution they would add across the possible coalitions to which they could join.

Particularly, for any coalition $S$ which does not include a player $i$, then player $i$'s marginal contribution is $v(S\cup\{i\}) - v(S)$. If we average such contributions for coalitions of size $k$:
\begin{equation}\label{eq:shapley_value2}
\hat{v}_{i,k} = \frac{1}{\binom{n-1}{k}}\sum_{S\subseteq N\setminus \{ i\} , |S|=k} %\frac{(n-|S|-1)!\,|S|!}{(n-1)!}
(v(S\cup\{i\})-v(S))
\end{equation}
Then we have the average marginal contribution of player $i$ to coalitions of size $k$, and if we average this over coalitions of different size, we get the Shapley value:
\begin{equation}\label{shap2} \varphi_i(\langle N,v\rangle) = \frac{1}{n}\sum_{k=0}^{n-1}\hat{v}_{i,k} \end{equation}
Or more directly as:
\begin{equation}\label{shap1_X}\varphi_i(\langle N,v\rangle) = \sum_{S\subset N, i\notin S}\frac{(n-|S|-1)!\,|S|!}{n!}(v(S\cup\{i\})-v(S))\end{equation}
The Shapley value is an averaging over a players marginal contributions, which is thus a unique allocation for any cooperative game.

The Shapley value for a player can also be formulated as being the expected marginal contribution across all join ordering processes.
So for instance, if we let $\pi(N)$ denote the set of all ordered permutations of the player set $N$ and if we denote $Pre^i(O)$ as the set of predecessors of player $i$'s addition in that ordering $O\in \pi(N)$. Then the Shapley value can be expressed as the average marginal contribution across orderings, \cite{weber_1988}:
\begin{equation}\label{shapley_value3}
    \varphi_i(\langle N,v\rangle) = \frac{1}{n!}\sum_{O\in\pi(N)}v(Pre^i(O)\cup\{i\})-v(Pre^i(O))
\end{equation}

In this way the Shapley value for a player can be directly expressed as the average marginal contribution across possible join order processes.
%Or alternatively,
%\begin{equation}\label{eq:shapley_value}
%    \varphi_i(\langle N,v\rangle)= \frac{1}{n}\sum_{S\subseteq N\setminus\{i\}} \binom{n-1}{|S|}^{-1} \left(v'(S\cup\{i\})-v'(S)\right) 
%\end{equation}

The Shapley value has perhaps some moral intuition behind it - rewarding each person in proportion to what they would add across any ordering that the coalition could form.
But more than that, the Shapley value has been derived from different sets of quite intuitive axioms.
For instance:

\begin{itemize}
\item	\textbf{Efficiency}: That the total dividend is broken up, $\sum_i\varphi(\langle N,v\rangle)_i = v(N)$
\item	\textbf{Symmetry}: If two players $i$ and $j$ are substitutes and contribute the same to all coalitions, such that if $v(S\cup i)=v(S\cup j)~~\forall S\subseteq N\setminus\{i,j\}$, then $\varphi(\langle N,v\rangle)_i = \varphi(\langle N,v\rangle)_j$
\item	\textbf{Dummy Player}: If a player $i$ is a dummy player if the amount that $i$ contributes to any coalition is the amount that $i$ is able to achieve alone (i.e.\ $v(S\cup \{i\})-v(S)=v(\{i\})~~\forall S\subseteq N\setminus\{i\}$) then $\varphi(\langle N,v\rangle)_i=v(\{i\})$
\item	\textbf{Additivity}: That for any two games, the imputation for the two together is the sum of the imputations in each, for any $v_1$ and $v_2$, $\varphi(\langle N,v_1+v_2\rangle)=\varphi(\langle N,v_1 \rangle) + \varphi(\langle N,v_2\rangle)$
\end{itemize}

These axioms might seem pretty reasonable and they lead uniquely to the Shapley value allocation \cite{Shapley1953a}; additionally there are other possible sets of axioms which also lead to the Shapley Value aswell.
These axioms (particularly Efficiency and Symmetry axioms) relate directly to morally relevant points raised in the philosophy section \ref{sec:philosophy} (Efficiency and formal equality conditions respectively).

In considering the Shapley value, there is the additional question of when the Shapley value is in the Core - and thus has that particular stability that would disincentivise any subgroup from leaving.
One example case where the Shapley Value is always in the Core is the case of Convex cooperative games \cite[Chapter 6]{RePEc:cup:cbooks:9781107691322}:
A cooperative game is \textit{convex} if the value that two coalitions together has is greater than the value of their parts minus the value of their intersection, ie. iff:
\begin{equation}
    \forall S,T\subset N \quad v(S\cup T) \ge v(S)+v(T)-v(S\cap T)
\end{equation}
Which is potentially a common condition in which each coalition is informally `greater than the sum of its parts'.
We consider an example:

\begin{example}
Consider player set $N=\{1,2,3\}$ with characteristic function:\\
$v(S)=\left(\prod_{i\in S}i\right)-1$ (ie. the multiplication of their player numbers minus one).\footnote{We are assuming that the product over an empty set is one.}\\
Solve for the shapley value, and show that it is efficient and also in the core.
\end{example}

\begin{solution}
To calculate the shapley value for player $C$, we consider the marginal contributions it can make to other coalitions:\\
$ v(\{C\})-v(\emptyset) = 2-0 = 2, \quad\quad\quad v(\{C,A\})-v(\{A\}) = 2-0 = 2$\\
$ v(\{C,B\})-v(\{B\}) = 5-1 = 4, \quad v(\{C,A,B\})-v(\{A,B\}) = 5-1 = 4  $\\
Thus the Shapley Value for player $C$ is:
$\varphi_C = \frac{1}{3}\left(2 + \frac{1}{2}(2+4) + 4\right) = 3$, and contiuing for the other players gives:
$\varphi_A = 0,\quad\varphi_B = 2$\\
The Shapley Value is efficient as: $\varphi_A+\varphi_B+\varphi_C = 5 = v(\{A,B,C\})$\\
and also in the Core, as it is true that:\\
$\varphi_A+\varphi_B=2\ge v(\{A,B\})=1$\\
$\varphi_A+\varphi_C=3\ge v(\{A,C\})=2$\\
$\varphi_B+\varphi_C=5\ge v(\{B,C\})=5$\\
It is also simple enough to verify that the cooperative game is convex.

\end{solution}

\subsection{Summary and applications to electricity systems}

Cooperative game theory concepts centre on the consideration of groups and how reward or surplus utility should be divided among members, and particularly the Shapley Value is most famous.

Indeed the Shapley Value has been considered as a potential mechanism for pricing in the various facets of electricity system operation.
Such as: demand response participation \cite{DBLP:journals/tsg/OBrienGR15,electronics8010048,WANG201972}, compensation for the aggregation of power \cite{Perez-Diaz:2018:CEV:3237383.3237484,6520960}, allocating transmission costs and losses \cite{ip-gtd_20020005,SHARMA201733}, allocating profits for retailers and \cite{ACUNA2018161,WANG201972}, allocating surplus and savings in microgrids \cite{WU2017384} and allocating costs in distribution and embedded networks \cite{archie_paper1,8226810,10.1007/978-3-642-40776-5_19,6840296,DBLP:journals/corr/abs-1903-10965,AzuatalamCV_PowerTech2019}.

In each of these cases, the primary difference is the context of application and the specific way in which the characteristic function is constructed.
%In any advocacy of the shapley value for an application, is tacitly advocacy of to each individual by the marginal contribution that they could add in a coalition formation process.
%Which may or may-not coincide with the Core and its coalitional stability property.
%In Chapter \ref{} we compare an application of the Shapley value applied to electricity systems against other allocation methods.

%Shapley value concepts are increasingly being considered as mechanisms for pricing and cost allocation in various facets of electricity system operation.
%Example include: demand response participation \cite{DBLP:journals/tsg/OBrienGR15,electronics8010048,WANG201972}; 
%compensation for the aggregation of power \cite{Perez-Diaz:2018:CEV:3237383.3237484,6520960};
%allocating transmission costs and losses \cite{ip-gtd_20020005,SHARMA201733}; allocating profits for retailers and \cite{ACUNA2018161,WANG201972}; 
%allocating surplus and savings in microgrids \cite{WU2017384} and; 
%allocating costs in distribution and embedded networks \cite{archie_paper1,8226810,10.1007/978-3-642-40776-5_19,6840296,DBLP:journals/corr/abs-1903-10965,AzuatalamCV_PowerTech2019}.

Just like in LMP and VCG, the Shapley Value is also evidently a marginal approach, as it is expressible the an average marginal contribution across possible groups (by equations \ref{shap2} or \ref{shapley_value3})

%Informally the difference between VCG, LMP and the Shapley Value can be seen as a difference between the allocation of reward: equal to contribution to the grand coalition, in-proportional to marginal contribution to the grand coalition, or equal to contribution not just to the grand coalition.

Just like for marginalist economics and mechanism design, there there is much more which could be said about cooperative game theory.
But as identified in the quote by Lloyd Shapley at the beginning of this section \ref{sec:cooperative_game_theory_part}, cooperative game theory is most applicable when the `worth' or `value' of a coalition is unambiguous, and when specific strategic considerations between the coalitions are unimportant (or are otherwise accounted for).
Thus in the next section \ref{sec:solutions_bargaining} we consider some solution concepts which apply in circumstances where it is not easy to describe the `worth' or `value' of a coalition of players; where strategic considerations between them are important and it is not easy to make sense of a characteristic function.
Particularly we describe bargaining solution concepts.


\section{Bargaining solution concepts}\label{sec:solutions_bargaining}

In discussing Locational Marginal Pricing (in section \ref{sec:solutions_LMP}), we considered a way of describing normalised pricing in large markets, however in this section we consider some of the various ways of describing normalised pricing among a small number of market participants where their individual strategic options are relevant.

Particularly, we consider the situation where there are a small numbers of market participants negotiating over a set of possible outcomes.
In this context, we consider what is a likely outcome of their bargaining process?

%In the first section of this chapter (section \ref{sec:solutions_VCG}) we considered the VCG solution, which allocates utility to a participant with respect to their contribution above their absense.
%And in the previous section (section \ref{sec:solutions_LMP}) we considered Marginal Pricing, which allocates utility to participants in proportion to their marginal absense.
%But in this section we consider the various ways in which this `absense' can be defined for each of the participants.

We begin with one of the most historic classes of bargaining solution concepts, particularly Nash bargaining with endogenous disagreement outcome.

\subsection{Nash bargaining with exogenous disagreement point}\label{sec:nash_bargaining_exogenous}



%This space of possible agreements may be over any variety of factors such as monetary transactions and electrical power flows etc, and hence it can be directly be made applicable for electricity networks.

A bargaining solution concept applies in a situation where there are a number of parties (or agents, or market participants) and a space of possible outcomes which those agents can reach by bargaining; and which each of them may value differently.
In this context, a bargaining solution concept identifies an outcome, which may be interpreted as one which the agents `will' (or `should') reach.
Perhaps the most famous bargaining solution concept is called the Nash-bargaining solution concept.

Nash bargaining was introduced by John Nash \cite{nash1} as an axiomatic approach to predict the normal result of idealised bargaining over potential outcomes.
It is defined over a set of potential outcomes $F$ % (which might coincide with power-flows and fiscal payments on an electricity network etc.) 
where each of the players $P=\{p_1,p_2,\dots\}$ value the outcomes differently with utilities $u_{p\in P}(f)$ for $f\in F$.
Additionally there is a privileged outcome called the `disagreement' outcome $d$ which represents the event of the negotiation between the players breaking down, and which any player can unilaterally implement.

Nash identified that in this case there is a unique solution satisfying some very intuitive axioms:
\begin{itemize}
\item \textit{Invariant to affine transformations}: that the solution should not change if the utilities of any of the players are scaled (by some positive factor) or offset, ie that they are invariant under the set of affine transformations% that might also represent their relative preferences.
\item \textit{Pareto optimality}: That the solution will not be inferior to any other point in the preferences of all players.
\item \textit{Independence of irrelevant alternatives} (IIA): If any subset of potential outcomes does not feature the solution point or the disagreement point, then it could be removed from consideration without affecting the solution.
\item \textit{Symmetry}: The solution is invariant with regards to the ordering of the players.
\end{itemize}
Nash identified that this solution maximises the product of utilities above the utility of the disagreement point:\cite{book1}
\begin{equation}\label{nash-product}\text{nash}(F,d) = \argmax_{(f\ge d)\in F}\prod_{p\in P}(u_p(f)-u_p(d))\end{equation}

%In this way the Nash-bargaining-solution can be seen as a simple solution concept, and potentially can be implemented in a process whereby the players report their valuations over potential outcomes, 
%and a Pareto-optimal outcome is determined which maximizes the product of those utilities above the disagreement outcome.

In many cases of physical bargaining (which might involve alternating offers etc.) the `disagreement outcome' is often naturally dictated by the context of the bargaining process - 
such as the event of quitting in the context of a wage-negotiation or of walking-away from a potential sale
- It can be seen as the point of `threat' from which the bargaining process proceeds.\cite{nash2}

There has been much work since Nash published his famous paper (\cite{nash1}) investigating other and/or similar solution concepts, and these bargaining solutions (such as \cite{smorodinsky,tempered,tale1,anbarci2002comparing}) often relate to different axioms (most often rejecting axiom IIA) and privilege different points in the bargaining process.

One objection to the Nash bargaining solution is that it may not be considered natural or a reliable description of real-world bargaining.
Although there does exist evolutionary models suggesting that Nash bargaining might naturally emerge in some social dynamics \cite{articlechoakihiko}, there also exists experimental work finding that real behaviour between humans exhibits ambiguity even in the case when the disagreement point is naturally given by the setting.\cite{KROLL2014261}

However in other cases (such as in an electricity network) a singular disagreement outcome may not be very clearly given by the context.
And so for a Nash bargaining solution concept to be applied then a disagreement outcome must be chosen from the set of possible outcomes.
Which leads to the question of how this should be done.

\subsection{Nash bargaining with endogenous disagreement point}\label{subsec:nash_bargaining_endogenous}

In John Nash's paper ``\textit{Two-person cooperative games}"\cite{nash2}, He explicitly addresses the consideration of the agents choosing a disagreement point between themselves in a prior stage in the bargaining process.

Particularly he considers a game specifically between two players, who reach a cooperative outcome in a series of stages of negotiations.
He considers that each of the players has a space of mixed strategies $S_i$ in a normal form game, and for each possible pair of mixed strategies that the players might execute, each receives an immediate payoff $p_1(s_1,s_2)$ and $p_2(s_1,s_2)$ respectively ($s_1\in S_1$, $s_2\in S_2$).
He also considers that there is a set $B$ of possible payoffs for the players if they cooperate, which may be bigger than the set of payoffs in the normal form game.\\
$\text{ie.}\quad \forall s_1\in S_1,s_2\in S_2 \quad (p_1(s_1,s_2), p_2(s_1,s_2)) \in B$

Nash then considers a specific negotiation process:
\begin{enumerate}
\item Each player $i$ chooses a mixed strategy $t_i$ that will be used if the two cannot come to an agreement - this is the threat.
\item The players inform each other of their threats.
\item Each player $i$ decides upon a demand $d_i$, where they will not accept any agreement which yields less than the utility $d_i$ to them.
\item If there is a point $(u_1,u_2)$ in B such that $u_1 \ge d_1$, and $u_2 \ge d_2$, then the pay-off to each player $i$ is $d_i$. Otherwise, the pay-off to each player $i$ is given by their threats, $p_i(t_l, t_2)$.
\end{enumerate}

This process encodes a process that includes two choices for the players, first, they must choose a `threat' strategy $t_i$ which they will be forced to execute if they cannot reach further agreement, and secondly they need to choose a `demand' $d_i$ of the utility which they would like to receive from the negotiation.
If it so happens that it is possible for the players to have their demands mutually met then they receive the utility associated with their demand, otherwise they receive the utility given by the actualisation of their threats.

Nash identifies that a natural choice of compatible demands in the second part of the game occurs at the maximising of the Nash product (Equation \ref{nash-product}) above a disagreement point determined by the execution of threat strategies (as elucidated in the previous section \ref{sec:nash_bargaining_exogenous})
Nash then identifies then that in light of this result for the second part of the game there exists a unique set of optimal choice of threats $t_i$ for the two players in the first part of the game; which is a Nash equilibrium of them with respect to the subsequent maximisation of the Nash product.

Nash also identifies this result via axioms:
\begin{enumerate}
\item For each game $(S_1,S_2,B)$ there is a unique solution $(v_1,v_2) \in B$
\item If $(u_1,u_2)$ is in $B$ and $u_1\ge v_1$ and $u_2\ge v_2$ then $(u_1,u_2)=(v_1,v_2)$
\item That order preserving linear transformation of utilities do not change the solution. ie. for games with all utilities scaled (ie $u_1' = a_1u_1+b_1, u_2' = a_2u_2+b_2$ for $a_1,a_2\ge 0$) result in solution $(v_1',v_2')$ where $v_1'=a_1v_1+b_1$ and $v_2'=a_2v_2+b_2$.
\item The solution does not depend on which player is player `one', ie. all functions are symmetrical
\item If points from $B$ are removed except $(v_1,v_2)$ and the points $(p_1(s_1,s_2), p_2(s_1,s_2))$ for all strategies $s_1\in S_1,s_2\in S_2$ then the new game yields the same solution.
\item A restriction of strategies for a player cannot increase his/her resulting payoffs, ie. for $S_1'\subset S_1$ then $v_1(S_1',S_2,B)\le v_1(S_1,S_2,B)$
\item There exists single (unmixed) strategies such that player one's value wont increase, ie. there exists $s_1,s_2$ such that $v_1(s_1,s_2,B)\le v_1(S_1,S_2,B)$
\end{enumerate}

These axioms are very similar to, but perhaps a little less obvious than Nash's game with exogenous disagreement point (as given in the previous subsection \ref{sec:nash_bargaining_exogenous}).
Let us consider an example game for the calculation of Nash bargaining with endogenous disagreement point:

\begin{example}
Consider the matrix representation of the strategic normal-form game between two players (a row player and column player respectively):
\begin{equation}\label{eq:example_game1} \begin{bmatrix}2,1 & -1,-2\\ -2,-1 & 1,2\end{bmatrix} \end{equation}
%And consider that these players can share utility between themselves (ie. a TU game). 
What is the the Nash bargaining solution for this game, if the set of possible payoffs is only that which can be attained by mixed strategies?\end{example}
\begin{solution}
We consider the space of possible payoffs between the players in the game for mixed strategies (see shaded region in figure \ref{fig:graph1_utilities})
%We observe that a point within the shaded region will be chosen by the players as a threat point.
%And then we ask what threat point will be a nash equilibrium between the players if they subsequently get the payoff given by the nash product (equation \ref{nash-product}).
and note that if the pure strategy payoff $(-1,-2)$ within the shaded region was chosen as the threat point by the players (highlighted by a black point; corresponding to the payoff in game row 1 \& column 2), then the subsequent payoff to the players would be $(2,1)$, since it is the point within the shaded region that maximises the product of utilities above $(-1,-2)$ (per equation \ref{nash-product}).
We also observe that the $(-1,-2)$ is a Nash-equilibrium as a choice of threat point, as if the column player chose the alternate column 1 instead, then the threat point would be $(2,1)$ which would effect the same outcome, and if the row player chose the alternate row 2 then the threat point would be $(1,2)$ which would be worse for the row player.
In this way it is seen that $(2,1)$ is the Nash bargaining solution for this game.
\end{solution}
\vspace{2mm}

This example comes directly from Neyman and Kohlberg's papers (\cite{value2,value1}) where it is explained that Nash's solution concept has a particularly simple form in games where utility is transferable (TU) \cite{value2,shap_lectures,value1}.\footnote{It also coincides with the `coco-value' in the case of complete information \cite{kalai1,Kalai2010}.}
The approach involves converting the normal form game \eqref{eq:example_game1} into a zero sum game by calculating the player advantage in payoffs, and our example zero sum game is given by \eqref{eq:zero_sum_game_1}.
If $d$ is the minimax value of the zero sum game, and if $s$ is the maximum sum of utility achievable in the normal form game, then the Nash bargaining solution is $(\frac{1}{2}s+\frac{1}{2}d,\frac{1}{2}s-\frac{1}{2}d)$.

\begin{equation}\label{eq:zero_sum_game_1} \begin{bmatrix}1 & 1\\ -1 & -1\end{bmatrix} \end{equation}

\begin{solution}[TU approach]
From \eqref{eq:example_game1} we see that the maximum sum of utility achievable between the players $s=3$. Then we compute the minimax value of the zero sum game \eqref{eq:zero_sum_game_1}, $d=1$ Which indicates that the row player has a greater threat power.
The Nash bargaining solution between the two players gives them utility as $(\frac{1}{2}s+\frac{1}{2}d,\frac{1}{2}s-\frac{1}{2}d) = (2,1)$
\end{solution}

It may seem to be a bit difficult to see how these two approaches are related at first glance.
However, it can be realised that in the context of selecting a threat point (for a TU game), all that matters is the player's payoff advantage over their opponent.
This fact can be seen by inspection of Figure \ref{fig:graph1_utilities}, where maximising the Nash product over a threat point places the final payoff point directly above and to the right (on the Pareto frontier) at a 45 degree angle.
In this context, the threat point only matters to the players insofar as it serves to moves the resulting payoff point along the Pareto frontier.
The Pareto frontier defines a set sum of player payoffs to be distributed, and hence the threat point only defines the difference of how much is distributed to one player over another - their payoff advantage. We also note that for these bargaining solution concepts, that there is a way in which an `individual rationality' property can be guaranteed, specifically, if both players have the ability to unilatterally implement zero utility for themself, then any disagreement point must be in the first quadrant, guaranteeing non-negative utility for both parties.

\subsection{Discussion of Nash bargaining concepts}

In this section we considered some bargaining solution concepts, particularly Nash's bargaining solution concept which gives an outcome that implicitly incorporates all the possible influences which the players can bear upon each other.
The solution concept for games of transferable utility (TU) depend primarily on the minimax of payoff advantages between the players.
In this way payoff advantage is considered as a measure of the strength of a player's bargaining position.

Nash's bargaining solution was principally suited for 2 players, however some extensions of it to many players have been developed.%\cite{values1,values2,values3}
In the following Chapter \ref{cha:new_solution} we develop these extensions of Nash's bargaining solution concept into a scheme applicable to electricity networks called the GNK value.

However, the contemplation of Nash bargaining solutions leads to the question of whether `threat' strategies should (or would) naturally play a role in the division of resources - such as in an electricity system.

Nash bargaining solutions are a primary example of a solution concept that explicitly considers the direct selection of possible 'threat' strategies for the players, and how these might bear on the result of cooperative negotiations.
This consideration contrasts against the LMP, VCG and Shapley Value concepts where the implicit reference point for each player may be interpreted as an articulation of their absence from cooperation - which may also be interpreted as a 'threat'.
However, unlike these other concepts, Nash bargaining with endogenous disagreement point removes any ambiguity and explicitly selects the point that would correspond to a failure of cooperation.

The moral ideas surrounding proportionality (per section \ref{sec:reference_points}) suggest that monetary compensation should be defined in relation to reference point/s, and Nash bargaining is one example solution concept that explicitly selects such a reference point; the question therefore is whether this selection process is the right one.

Nash bargaining attempt to mathematically identify outcomes that are a cooperative result underpinned by perfect competition under equilibrium, and hence can potentially serve as a description of normalised and idealised trading;
In more realistic contexts, the selection of moral reference points may be influenced by a range of moral or practical factors, and we can ask, when an equilibrium of `threat' strategies would bear practical relevance.
Particularly it is identified by Nash that the role of threats in negotiations depends on a dynamic about their ability to be enforced.

\begin{displayquote}
A common device in negotiation is the threat ... If one considers the process of making a threat, one sees that its elements are as follows: A threatens B by convincing B that if B does not act in compliance with A's demands, then A will follow a certain policy T. Supposing A and B to be rational beings, it is essential for the success of the threat that A be compelled to carry out his threat T if B fails to comply. Otherwise it will have little meaning. For, in general, to execute the threat will not be something A would want to do, just of itself.
(\cite{nash2})
\end{displayquote}

In this light, it is pertinent to consider where threats do and do not play a role in real-world negotiations (such as discussed in \cite{anbarci2002comparing}) and subsequently to consider whether or not threat dynamics could or should be manifest in electricity systems.
In the following Chapter we explore this question by developing a direct extension of Nash's bargaining solution concept into a scheme applicable to electricity networks called the GNK value, and apply it to electricity systems to witness its features.%, particularly as there are alternative bargaining solution concepts that do not involve threats (eg. \cite{bozbay}).

%It is also good to note that Nash's threat point is unique only in the two player context, for three or more players there can exist multiple Nash equilibrium in the selection of threats.\cite{10.2307/43616981}\\

\input{figs/nash_game.tex}

\section{Comparison \& summary}

In this chapter we have explored four different ways in which ethical ideas about distribution can be mathematised, and each of them have different features and encode different moral perspectives.

Specifically we have introduced and illustrated the Vickrey-Clarke-Groves (VCG) mechanism, Locational Marginal Pricing (LMP), the Shapley Value, and Nash bargaining solution concepts.
Each of the ideas embody different rules and respect different moral reference point/s.

And as identified by the philosophy of the previous chapter, none of these solutions are simply right or wrong per sei; but each have their features and limitations, and hence have arenas where they are potentially more suitable than others.

One particularly interesting feature of the Nash-bargaining solution is that it considers the minimax payoff advantage as a measure of competitive strength between participants, and it allocates utility accordingly.
However the Nash bargaining solution is limited to two players, as for three (or more) players there may not exist a unique zero-sum minimax value.
In the following chapter \ref{cha:new_solution} we construct an extension of Nash bargaining solution called the GNK value, that is built around Shapley Value axioms; and compare it to LMP and VCG in the context of electricity networks so that we can make moral judgements about the suitability of them for that context.




